# Netlify settings
#
# Other Netlify files:
# - runtime.txt: version of Python to build with
#
# “command” is your build command,
#
[build]
base = ""
command = """
pip install --upgrade pip \
&& pip install --upgrade --upgrade-strategy eager  -e ".[dev]" \
&& pip install git+https://oauth:${MKDOCS_MATERIAL_INSIDERS_REPO_RO}@github.com/PrefectHQ/mkdocs-material-insiders.git@d7aff94f888b6f3300d32e25d37836333582e44c\
&& prefect dev build-docs \
&& mkdocs build --config-file mkdocs.insiders.yml \
"""
publish = "site"

# Redirects 

# redirect v1 traffic to docs-v1.prefect.io

[[redirects]]
from = "/core/*"
to = "https://docs-v1.prefect.io/core/:splat"
status = 301

[[redirects]]
from = "/orchestration/*"
to = "https://docs-v1.prefect.io/orchestration/:splat"
status = 301

[[redirects]]
from = "/api/*"
to = "https://docs-v1.prefect.io/api/:splat"
status = 301

[[redirects]]
from = "https://orion-docs.prefect.io/*"
to = "https://docs.prefect.io/:splat"
status = 301

# Netlify redirect rules match on the first rule, 
# so to have /latest/ version 
# also redirect. So need to explicitly catch /latest/...
# Each of the rules below for a Prefect 2 URL redirect 
# has a counterpart further below with /latest/ prefix


[[redirects]]
from = "/api-ref/orion/*"
to = "/api-ref/server/:splat"
status = 301

[[redirects]]
from = "/tutorials/*"
to = "/tutorial/:splat"
status = 301

[[redirects]]
from = "/migration_guide/"
to = "/guides/migration-guide/"
status = 301

[[redirects]]
from = "/ui/work-queues/"
to = "/cloud/work-pools/"
status = 301

[[redirects]]
from = "/concepts/work-queues/"
to = "/concepts/work-pools/"
status = 301

[[redirects]]
from = "/ui/cloud-getting-started/"
to = "/getting-started/quickstart/"
status = 301

[[redirects]]
from = "/ui/overview/"
to = "/cloud/"
status = 301

[[redirects]]
from = "/api-ref/overview"
to = "/api-ref/"
status = 301

[[redirects]]
from = "/concepts/overview/"
to = "/concepts/"
status = 301

[[redirects]]
from = "/collections/catalog/"
to = "/integrations/"
status = 301

[[redirects]]
from = "/collections/usage/"
to = "/integrations/usage/"
status = 301

[[redirects]]
from = "/collections/contribute/"
to = "/integrations/contribute/"
status = 301

[[redirects]]
from = "/migration-guide/"
to = "/guides/migration-guide/"
status = 301

[[redirects]]
from = "/recipes/contribute-recipes/"
to = "/recipes/recipes/"
status = 301

[[redirects]]
from = "/tutorials/docker/"
to = "/guides/deployment/docker/"
status = 301

[[redirects]]
from = "/tutorials/cloud-agent/"
to = "/guides/deployment/aci/"
status = 301

[[redirects]]
from = "/tutorials/testing/"
to = "/guides/testing/"
status = 301

[[redirects]]
from = "/tutorials/dask-ray-task-runners/"
to = "/guides/dask-ray-task-runners/"
status = 301

[[redirects]]
from = "/api-ref/prefect/blocks/storage/"
to = "/api-ref/prefect/blocks/filesystems/"
status = 301

[[redirects]]
from = "/tutorials/flow-task/"
to = "/tutorials/first-steps/"
status = 301

[[redirects]]
from = "/integrations/catalog/"
to = "/integrations/"
status = 301

[[redirects]]
from = "/ui/flows-and-tasks/"
to = "/concepts/flows/"
status = 301

[[redirects]]
from = "/getting-started/overview/"
to = "/"
status = 301
 
[[redirects]]
from = "/ui/index/"
to = "/cloud/"
status = 301

[[redirects]]
from = "/ui/cloud/"
to = "/cloud/"
status = 301

[[redirects]]
from = "/ui/cloud-quickstart/" 
to = "/getting-started/quickstart/"
status = 301

[[redirects]]
from = "/ui/cloud-api-keys/"
to = "/cloud/users/api-keys/"
status = 301

[[redirects]]
from = "/ui/cloud-local-environment/"
to = "/cloud/connecting/"
status = 301

[[redirects]]
from = "/ui/organizations/"
to = "/cloud/"
status = 301

[[redirects]]
from = "/ui/workspaces/"
to = "/cloud/workspaces/"
status = 301

[[redirects]]
from = "/ui/service-accounts/"
to = "/cloud/users/service-accounts/"
status = 301

[[redirects]]
from = "/ui/roles/"
to = "/cloud/users/roles/"
status = 301

[[redirects]]
from = "/ui/sso/"
to = "/cloud/users/sso/"
status = 301

[[redirects]]
from = "/ui/audit-log/"
to = "/cloud/users/audit-log/"
status = 301

[[redirects]]
from = "/ui/automations/"
to = "/concepts/automations/"
status = 301

[[redirects]]
from = "/ui/events/"
to = "/cloud/events/"
status = 301

[[redirects]]
from = "/ui/troubleshooting/"
to = "/cloud/connecting/"
status = 301

[[redirects]]
from = "/ui/rate-limits/"
to = "/cloud/rate-limits/"
status = 301

[[redirects]]
from = "/cloud/overview/"
to = "/cloud/"
status = 301

[[redirects]]
from = "/api-ref/prefect/blocks/storage/"
to = "/api-ref/prefect/blocks/"
status = 301

[[redirects]]
from = "/api-ref/prefect/deployments/"
to = "/api-ref/prefect/deployments/deployments/"
status = 301

[[redirects]]
from = "/tutorial/deployments-ux/"
to = "/tutorial/deployments/"
status = 301

[[redirects]]
from = "/ui/blocks/"
to = "/concepts/blocks/"
status = 301

[[redirects]]
from = "/ui/work-pools/"
to = "/concepts/work-pools/"
status = 301


[[redirects]]
from = "/concepts/server/"
to = "/host/"
status = 301


[[redirects]]
from = "/concepts/database/"
to = "/host/"
status = 301

[[redirects]]
from = "/ui/notifications/"
to = "/host/#notifications"
status = 301

[[redirects]]
from = "/concepts/notifications/"
to = "/host/#notifications"
status = 301

[[redirects]]
from = "/ui/work-pools/"
to = "/concepts/work-pools/"
status = 301

[[redirects]]
from = "/ui/"
to = "/cloud/"
status = 301

[[redirects]]
from = "/ui/task-concurrency"
to = "/concepts/tasks/"
status = 301

[[redirects]]
from = "/ui/flow-runs"
to = "/concepts/flows/"
status = 301

[[redirects]]
from = "/ui/deployments"
to = "/concepts/deployments/"
status = 301

[[redirects]]
from = "/ui/cloud-quickstart/"
to = "/getting-started/quickstart/"
status = 301

[[redirects]]
from = "/tutorials/developing-a-new-worker-type/"
to = "/guides/deployment/developing-a-new-worker-type/"
status = 301

[[redirects]]
from = "/api-ref/rest-api-overview/"
to = "/api-ref/rest-api/"
status = 301

[[redirects]]
from = "/concepts/projects/"
to = "/concepts/deployments/"
status = 301

[[redirects]]
from = "/tutorial/projects/"
to = "/tutorial/deployments-ux/"
status = 301

[[redirects]]
from = "/api-ref/prefect/projects/"
to = "/api-ref/prefect/deployments-ux/"
status = 301

[[redirects]]
from = "/api-ref/prefect/projects/"
to = "/api-ref/prefect/deployments-ux/"
status = 301

[[redirects]]
from = "/guides/cloud-run-push-work-pools/"
to = "/guides/deployment/push-work-pools/"
status = 301

[[redirects]]
from = "/concepts/logs/"
to = "/guides/logs/"
status = 301

[[redirects]]
from = "/concepts/runtime-context/"
to = "/guides/runtime-context/"
status = 301

[[redirects]]
from = "/concepts/settings/"
to = "/guides/settings/"
status = 301

[[redirects]]
from = "/concepts/variables/"
to = "/guides/variables/"
status = 301

[[redirects]]
from = "/cloud/webhooks/"
to = "/guides/webhooks/"
status = 301

[[redirects]]
from = "/concepts/events/"
to = "/cloud/events/"
status = 301

[[redirects]]
from = "/cloud/automations/"
to = "/concepts/automations/"
status = 301

[[redirects]]
from = "/host/"
to = "/guides/host/"
status = 301

[[redirects]]
from = "/concepts/deployments-ux/"
to = "/concepts/deployments/"
status = 301

[[redirects]]
from = "/guides/deployment/helm-worker/"
to = "/guides/deployment/kubernetes/"
status = 301

[[redirects]]
from = "/guides/deployment/docker/"
to = "/guides/docker/"
status = 301

[[redirects]]
from = "/cloud/cloud-quickstart/"
to = "/getting-started/quickstart/"
status = 301

[[redirects]]
from = "/cloud/organizations/*"
to = "/cloud/"
status = 301

[[redirects]]
from = "/guides/deployment/aci/"
to = "/guides/deployment/serverless-workers/"
status = 301

[[redirects]]
from = "/contributing/common-mistakes/"
to = "/guides/troubleshooting/"
status = 301

[[redirects]]
from = "/concepts/incidents"
to = "/cloud/incidents"
status = 301

[[redirects]]
from = "/tutorial/first-steps/"
to = "/#prefect-quickstart/"
status = 301

[[redirects]]
from = "/collections/overview/"
to = "/integrations/catalog/"
status = 301

# Netlify redirect rules match on the first rule, 
# so to have /latest/ version 
# also redirect. So need to explicitly catch /latest/...
# Each of the above rules for a Prefect 2 URL redirect 
# is below with /latest/ prefix

[[redirects]]
from = "/latest/api-ref/orion/*"
to = "/api-ref/server/:splat"
status = 301

[[redirects]]
from = "/latest/tutorials/*"
to = "/tutorial/:splat"
status = 301

[[redirects]]
from = "/latest/migration_guide/"
to = "/guides/migration-guide/"
status = 301

[[redirects]]
from = "/latest/ui/work-queues/"
to = "/cloud/work-pools/"
status = 301

[[redirects]]
from = "/latest/concepts/work-queues/"
to = "/concepts/work-pools/"
status = 301

[[redirects]]
from = "/latest/ui/cloud-getting-started/"
to = "/getting-started/quickstart/"
status = 301

[[redirects]]
from = "/latest/ui/overview/"
to = "/cloud/"
status = 301

[[redirects]]
from = "/latest/api-ref/overview"
to = "/api-ref/"
status = 301

[[redirects]]
from = "/latest/concepts/overview/"
to = "/concepts/"
status = 301

[[redirects]]
from = "/latest/collections/catalog/"
to = "/integrations/"
status = 301

[[redirects]]
from = "/latest/collections/usage/"
to = "/integrations/usage/"
status = 301

[[redirects]]
from = "/latest/collections/contribute/"
to = "/integrations/contribute/"
status = 301

[[redirects]]
from = "/latest/migration-guide/"
to = "/guides/migration-guide/"
status = 301

[[redirects]]
from = "/latest/recipes/contribute-recipes/"
to = "/recipes/recipes/"
status = 301

[[redirects]]
from = "/latest/tutorials/docker/"
to = "/guides/deployment/docker/"
status = 301

[[redirects]]
from = "/latest/tutorials/cloud-agent/"
to = "/guides/deployment/aci/"
status = 301

[[redirects]]
from = "/latest/tutorials/testing/"
to = "/guides/testing/"
status = 301

[[redirects]]
from = "/latest/tutorials/dask-ray-task-runners/"
to = "/guides/dask-ray-task-runners/"
status = 301

[[redirects]]
from = "/latest/api-ref/prefect/blocks/storage/"
to = "/api-ref/prefect/blocks/filesystems/"
status = 301

[[redirects]]
from = "/latest/tutorials/flow-task/"
to = "/tutorials/first-steps/"
status = 301

[[redirects]]
from = "/latest/integrations/catalog/"
to = "/integrations/"
status = 301

[[redirects]]
from = "/latest/ui/flows-and-tasks/"
to = "/concepts/flows/"
status = 301

[[redirects]]
from = "/latest/getting-started/overview/"
to = "/"
status = 301
 
[[redirects]]
from = "/latest/ui/index/"
to = "/cloud/"
status = 301

[[redirects]]
from = "/latest/ui/cloud/"
to = "/cloud/"
status = 301

[[redirects]]
from = "/latest/ui/cloud-quickstart/" 
to = "/getting-started/quickstart/"
status = 301

[[redirects]]
from = "/latest/ui/cloud-api-keys/"
to = "/cloud/users/api-keys/"
status = 301

[[redirects]]
from = "/latest/ui/cloud-local-environment/"
to = "/cloud/connecting/"
status = 301

[[redirects]]
from = "/latest/ui/organizations/"
to = "/cloud/"
status = 301

[[redirects]]
from = "/latest/ui/workspaces/"
to = "/cloud/workspaces/"
status = 301

[[redirects]]
from = "/latest/ui/service-accounts/"
to = "/cloud/users/service-accounts/"
status = 301

[[redirects]]
from = "/latest/ui/roles/"
to = "/cloud/users/roles/"
status = 301

[[redirects]]
from = "/latest/ui/sso/"
to = "/cloud/users/sso/"
status = 301

[[redirects]]
from = "/latest/ui/audit-log/"
to = "/cloud/users/audit-log/"
status = 301

[[redirects]]
from = "/latest/ui/automations/"
to = "/concepts/automations/"
status = 301

[[redirects]]
from = "/latest/ui/events/"
to = "/cloud/events/"
status = 301

[[redirects]]
from = "/latest/ui/troubleshooting/"
to = "/cloud/connecting/"
status = 301

[[redirects]]
from = "/latest/ui/rate-limits/"
to = "/cloud/rate-limits/"
status = 301

[[redirects]]
from = "/latest/cloud/overview/"
to = "/cloud/"
status = 301

[[redirects]]
from = "/latest/api-ref/prefect/blocks/storage/"
to = "/api-ref/prefect/blocks/"
status = 301

[[redirects]]
from = "/latest/api-ref/prefect/deployments/"
to = "/api-ref/prefect/deployments/deployments/"
status = 301

[[redirects]]
from = "/latest/tutorial/deployments-ux/"
to = "/tutorial/deployments/"
status = 301

[[redirects]]
from = "/latest/ui/blocks/"
to = "/concepts/blocks/"
status = 301

[[redirects]]
from = "/latest/ui/work-pools/"
to = "/concepts/work-pools/"
status = 301


[[redirects]]
from = "/latest/concepts/server/"
to = "/host/"
status = 301


[[redirects]]
from = "/latest/concepts/database/"
to = "/host/"
status = 301

[[redirects]]
from = "/latest/ui/notifications/"
to = "/host/#notifications"
status = 301

[[redirects]]
from = "/latest/concepts/notifications/"
to = "/host/#notifications"
status = 301

[[redirects]]
from = "/latest/ui/work-pools/"
to = "/concepts/work-pools/"
status = 301

[[redirects]]
from = "/latest/ui/"
to = "/cloud/"
status = 301

[[redirects]]
from = "/latest/ui/task-concurrency"
to = "/concepts/tasks/"
status = 301

[[redirects]]
from = "/latest/ui/flow-runs"
to = "/concepts/flows/"
status = 301

[[redirects]]
from = "/latest/ui/deployments"
to = "/concepts/deployments/"
status = 301

[[redirects]]
from = "/latest/ui/cloud-quickstart/"
to = "/getting-started/quickstart/"
status = 301

[[redirects]]
from = "/latest/tutorials/developing-a-new-worker-type/"
to = "/guides/deployment/developing-a-new-worker-type/"
status = 301

[[redirects]]
from = "/latest/api-ref/rest-api-overview/"
to = "/api-ref/rest-api/"
status = 301

[[redirects]]
from = "/latest/concepts/projects/"
to = "/concepts/deployments/"
status = 301

[[redirects]]
from = "/latest/tutorial/projects/"
to = "/tutorial/deployments-ux/"
status = 301

[[redirects]]
from = "/latest/api-ref/prefect/projects/"
to = "/api-ref/prefect/deployments-ux/"
status = 301

[[redirects]]
from = "/latest/api-ref/prefect/projects/"
to = "/api-ref/prefect/deployments-ux/"
status = 301

[[redirects]]
from = "/latest/guides/cloud-run-push-work-pools/"
to = "/guides/deployment/push-work-pools/"
status = 301

[[redirects]]
from = "/latest/concepts/logs/"
to = "/guides/logs/"
status = 301

[[redirects]]
from = "/latest/concepts/runtime-context/"
to = "/guides/runtime-context/"
status = 301

[[redirects]]
from = "/latest/concepts/settings/"
to = "/guides/settings/"
status = 301

[[redirects]]
from = "/latest/concepts/variables/"
to = "/guides/variables/"
status = 301

[[redirects]]
from = "/latest/cloud/webhooks/"
to = "/guides/webhooks/"
status = 301

[[redirects]]
from = "/latest/concepts/events/"
to = "/cloud/events/"
status = 301

[[redirects]]
from = "/latest/cloud/automations/"
to = "/concepts/automations/"
status = 301

[[redirects]]
from = "/latest/host/"
to = "/guides/host/"
status = 301

[[redirects]]
from = "/latest/concepts/deployments-ux/"
to = "/concepts/deployments/"
status = 301

[[redirects]]
from = "/latest/guides/deployment/helm-worker/"
to = "/guides/deployment/kubernetes/"
status = 301

[[redirects]]
from = "/latest/guides/deployment/docker/"
to = "/guides/docker/"
status = 301

[[redirects]]
from = "/latest/cloud/cloud-quickstart/"
to = "/getting-started/quickstart/"
status = 301

[[redirects]]
from = "/latest/cloud/organizations/*"
to = "/cloud/"
status = 301

[[redirects]]
from = "/latest/guides/deployment/aci/"
to = "/guides/deployment/serverless-workers/"
status = 301

[[redirects]]
from = "/latest/contributing/common-mistakes/"
to = "/guides/troubleshooting/"
status = 301

[[redirects]]
from = "/latest/concepts/incidents"
to = "/cloud/incidents"
status = 301

[[redirects]]
from = "/latest/tutorial/first-steps/"
to = "/#prefect-quickstart/"
status = 301

[[redirects]]
from = "/latest/collections/overview/"
to = "/integrations/catalog/"
status = 301



[[headers]]
# Define which paths this specific [[headers]] block will cover.
for = "/*"

[headers.values]
# X-Content-Type-Options controls whether browsers attempt to detect
# the content type, rather than relyihng on the Content-Type header.
# https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Content-Type-Options
X-Content-Type-Options = "nosniff"

# Strict-Transport-Security to require HTTPS connections in supported
# browsers. These settings are required to be eligible for inclusion
# in the HSTS Preload list; see: https://hstspreload.org/
Strict-Transport-Security = """
      max-age=31536000; \
      includeSubDomains; \
      preload \
      """

# Content-Security-Policy to prevent XSS attacks.
#
# default-src
#   'none' - all resources from current origin are blocked by default
# connect-src
#   'self' - all connections to current current origin are permitted
#   https://api.github.com - required to display release information
#   https://www.google-analytics.com - Google Analytics
# font-src
#   https://fonts.gstatic.com - load fonts from Google Fonts
# frame-ancestors
#   'none' - prevent embedding as a frame
# frame-src
#   'none' - prevent framing by default
#   https://www.youtube.com - allow embedding of YouTube videos
# img-src
#   'self' - all images from current origin are permitted
#   data: - images embedded inline are permitted
#   https://avatars.githubusercontent.com - embed user images from GitHub
#   https://cdn.redoc.ly - Redocly adds a logo at the bottom of the page
#   https://img.shields.io - embed badges from shields.io
# media-src
#   'none' - no audio or video files are permitted
# object-src
#   'none' - no legacy objects are allowed; see
#            https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy/object-src
# script-src
#   'self' - all resources from current origin are permitted
# script-src-elem
#   'self' - all resources from current origin are permitted
#   'unsafe-inline' - required for scripts loaded in partials
#   https://unpkg.com - required for Swagger rendering plugin
#   https://www.googletagmanager.com - allow snippet customization using Google Tag Manager
# style-src
#   'self' - all styles from current origin are permitted
#   'unsafe-inline' - required for styles loaded in partials
# worker-src
#   'self' - allow web workers from current origin
#   blob: - required by Redocly for a generated Worker
Content-Security-Policy = """\
      default-src \
        'none' \
        ; \
      connect-src \
        'self' \
        https://api.github.com \
        https://www.google-analytics.com \
        ; \
      font-src 
        https://fonts.gstatic.com \
        ; \
      frame-ancestors 'none' \
        ; \
      frame-src 
        https://www.youtube.com \
        ; \
      img-src \
        'self' \
        data: \
        https://avatars.githubusercontent.com \
        https://cdn.redoc.ly \
        https://img.shields.io \
        ; \
      media-src \
      'none' \
        ; \
      object-src \
        'none' \
        ; \
      script-src \
        'self' \
      ; \
      script-src-elem \
        'self' \
        'unsafe-inline' \
        https://unpkg.com \
        https://www.googletagmanager.com \
        ; \
      style-src \
        'self' \
        'unsafe-inline' \
        https://fonts.googleapis.com/ \
        ; \
      worker-src \
        'self' \
        blob: \
        ; \
      """

# Referrer-Policy controls the Referer header in requests.
#
# same-origin allows analytics tools to understand user journeys.
Referrer-Policy = "same-origin"

# X-Permitted-Cross-Domain-Policies controls whether this site can be
# embedded into Flash applications or PDF documents.
X-Permitted-Cross-Domain-Policies = "none"

# Permissions-Policy controls the features that the site can request.

# https://developer.chrome.com/en/docs/privacy-sandbox/permissions-policy/
# https://github.com/w3c/webappsec-permissions-policy/blob/main/features.md
Permissions-Policy = """\
      accelerometer=(), \
      ambient-light-sensor=(), \
      autoplay=(), \
      battery=(), \
      camera=(), \
      cross-origin-isolated=(), \
      display-capture=(), \
      document-domain=(), \
      encrypted-media=(), \
      execution-while-not-rendered=(), \
      execution-while-out-of-viewport=(), \
      fullscreen=(), \
      geolocation=(), \
      gyroscope=(), \
      hid=(), \
      idle-detection=(), \
      magnetometer=(), \
      microphone=(), \
      midi=(), \
      navigation-override=(), \
      payment=(), \
      picture-in-picture=(), \
      publickey-credentials-get=(), \
      screen-wake-lock=(), \
      serial=(), \
      sync-xhr=(), \
      usb=(), \
      web-share=(), \
      xr-spatial-tracking=() \
      """

[[edge_functions]]
path = "/2/httpapi"
function = "amplitude"
