# The components of Orion 

Orion is a collection of services that form a dedicated _orchestration environment_:

- the **database** is the persistent metadata store that holds flow and task run history, along with [references to data][prefect.orion.schemas.data] produced by tasks and flows
- the **webserver** serves [a REST API](/api-ref/rest-api/) backed by [FastAPI](https://fastapi.tiangolo.com/) that receives information emitted from workflows and additionally responds with orchestration instructions
- the **agent** is a small polling process responsible for submitting _flow_ runs as local processes
- the **UI** is the flexible control plane for monitoring, configuring and analyzing your Prefect workflows

!!! tip "All at once"
    Below we break down each component of Orion individually; to quickly spin up all services simultaneously you can use the simple `prefect orion start` CLI command which should produce output similar to this:
    <div class="termy">
    ```
    $ prefect orion start
    Starting Orion API...
    INFO:     Started server process [36974]
    INFO:     Waiting for application startup.
    2021-09-29 13:05:44,361 - prefect.orion - INFO - Agent service scheduled to start in-app
    2021-09-29 13:05:44,362 - prefect.orion - INFO - Scheduler service scheduled to start in-app
    2021-09-29 13:05:44,362 - prefect.orion - INFO - MarkLateRuns service scheduled to start in-app
    2021-09-29 13:05:44,385 - prefect.orion.services.marklateruns - DEBUG - About to run MarkLateRuns...
    INFO:     Application startup complete.
    INFO:     Uvicorn running on http://127.0.0.1:4200 (Press CTRL+C to quit)
    ```
    </div>

## The database

The database is the persistent layer that powers many of the features and functionality of Orion.  Currently Orion supports the following databases:

- SQLite: the default in Orion; best for lightweight single server deployments and requires essentially no setup
- PostgreSQL: best for connecting to external databases but does require additional setup (such as Docker)

Whenever you first install Orion, your database will be located at `~/.prefect/orion.db`. To configure this location, you can specify a connection URL with the `PREFECT_ORION_DATABASE_CONNECTION_URL` environment variable:

```
export PREFECT_ORION_DATABASE_CONNECTION_URL="sqlite+aiosqlite:////full/path/to/a/location/orion.db"
```

!!! tip "In-memory databases"
    One of the benefits of SQLite is in-memory database support; in-memory databases are only supported in Orion for testing purposes and are not compatible with multiprocessing.  To use an in-memory sqlite database, set the following environment variable:
    ```
    export PREFECT_ORION_DATABASE_CONNECTION_URL="sqlite+aiosqlite:///file::memory:?cache=shared&uri=true&check_same_thread=false"
    ```

!!! danger "Migrations"
    Recall that Orion is available as [a technical preivew](/faq/#why-is-orion-a-technical-preview); this means that aspects of Orion's schema are still under active development and therefore upgrades should be considered destructive.  As it nears official release, database migration guides and tooling will be available and documented.

## The webserver

The Orion webserver can be stood up with a single CLI command:

<div class="termy">
```
$ prefect orion start --no-services
Starting Orion API...
INFO:     Started server process [84081]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
INFO:     Uvicorn running on http://127.0.0.1:4200 (Press CTRL+C to quit)
```
</div>

There are numerous ways to begin exploring the API:

- navigate to [http://127.0.0.1:4200/docs](http://127.0.0.1:4200/docs) (or your corresponding API URL) to see the autogenerated Swagger API documentation
- navigate to [http://127.0.0.1:4200/redoc](http://127.0.0.1:4200/redoc) (or your corresponding API URL) to see the autogenerated Redoc API documentation
- instantiate [an asynchronous `OrionClient`][prefect.client] within Python to send requests to the API

During normal operation is it not expected that you will need to interact with the API directly, as this is handled automatically for you within the Python client and the UI.

## The agent

The Orion agent is a lightweight process responsible for submitting both scheduled and manually triggered deployments.  

- does the agent connect to the DB directly right now? 
- we may want to expose a configurable URL for the API

## The UI

TBD

!!! tip "Additional Reading"
    To learn more about the concepts presented here, check out the following resources:

    - [Orion REST API Specification](/api-ref/rest/)
    - [Deployments](/concepts/deployments/)
