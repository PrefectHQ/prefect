---
title: Interact with the REST API
description: Explore examples of interacting with the REST API.
---

It may sometimes be necessary to interact with the Prefect REST API directly, without `prefect` installed.

<Warning>
If you're using Python, it is recommended to use [`uv`](https://docs.astral.sh/uv/) to install and use the `prefect` SDK's client methods to interact with the API.

See [Interact with the API](/v3/develop/interact-with-api/) for more on how to use the `PrefectClient`.
</Warning>

See [REST API Overview](/v3/api-ref/rest-api/) for details on Prefect's REST API philosophy and the [interactive REST API documentation](https://app.prefect.cloud/api/docs) for details.


## Examples

### Creating an `S3Bucket` block with `AwsCredentials`

Set up your environment (env vars or `.env` file)
```bash
# required
export AWS_ACCESS_KEY_ID=your_key
export AWS_SECRET_ACCESS_KEY=your_secret
export AWS_REGION=us-east-1
export S3_BUCKET_NAME=your-bucket

# optional - if not set, will use localhost:4200
export PREFECT_API_KEY=your_key
export PREFECT_ACCOUNT_ID=your_account
export PREFECT_WORKSPACE_ID=your_workspace
```

<Accordion title="Don't have cloud or a server running?">

```bash
uvx prefect server start --background
```
Don't panic - run a server in the background üôÇ
</Accordion>

#### Endpoints Used

This example demonstrates using the following REST endpoints:

- `GET /block_types/slug/{slug}` - Get block type by slug
- `POST /block_schemas/filter` - Get latest schema for a block type
- `POST /block_documents/` - Create a new block
- `POST /block_documents/filter` - Get existing block by name
- `GET /block_documents/{id}` - Verify block structure

#### Implementation

First, set up the settings model to gather configuration.

```python
class PrefectSettings(BaseSettings):
    model_config = SettingsConfigDict(env_file=".env", extra="ignore")
    
    # if these are not set, we'll use localhost
    PREFECT_API_KEY: str | None = Field(default=None)
    PREFECT_ACCOUNT_ID: str | None = Field(default=None)
    PREFECT_WORKSPACE_ID: str | None = Field(default=None)
    
    AWS_ACCESS_KEY_ID: str = Field(default=...)
    AWS_SECRET_ACCESS_KEY: str = Field(default=...)
    AWS_REGION: str = Field(default="us-east-1")
    S3_BUCKET_NAME: str = Field(default=...)

    @property
    def api_url(self) -> str:
        if all([self.PREFECT_API_KEY, self.PREFECT_ACCOUNT_ID, self.PREFECT_WORKSPACE_ID]):
            return (
                f"https://api.prefect.cloud/api/accounts/{self.PREFECT_ACCOUNT_ID}"
                f"/workspaces/{self.PREFECT_WORKSPACE_ID}"
            )
        return "http://127.0.0.1:4200/api"

    @property
    def api_headers(self) -> dict[str, str]:
        if self.PREFECT_API_KEY:
            return {"Authorization": f"Bearer {self.PREFECT_API_KEY}"}
        return {}
```

Create a helper function to handle block creation and retrieval:

```python
def get_or_create_block(
    client: httpx.Client, name: str, block_type_id: str, data: dict[str, Any]
) -> dict[str, Any]:
    schema = sorted(
        client.post("/block_schemas/filter", json={"block_type_id": block_type_id})
        .raise_for_status()
        .json(),
        key=lambda x: x.get("created", ""),
    )[-1]

    if (
        response := (
            client.post(
                "/block_documents/",
                json={
                    "name": name,
                    "block_type_id": block_type_id,
                    "block_schema_id": schema["id"],
                    "data": data,
                },
            )
        )
    ).is_success:
        return response.json()

    if response.status_code == 409:
        blocks = (
            client.post(
                "/block_documents/filter",
                json={"block_documents": {"name": {"any_": [name]}}},
            )
            .raise_for_status()
            .json()
        )
        if not blocks:
            raise RuntimeError(f"Block {name} not found after 409 response")
        return blocks[0]

    response.raise_for_status()
    raise RuntimeError("Unexpected response")
```

Initialize the client and create the blocks:

```python
settings = PrefectSettings()
print(f"üîë Connecting to {settings.api_url}")
client = httpx.Client(
    base_url=settings.api_url,
    headers=settings.api_headers,
)

aws_creds = get_or_create_block(
    client,
    name="demo-aws-creds",
    block_type_id=client.get("/block_types/slug/aws-credentials")
    .raise_for_status()
    .json()["id"],
    data={
        "aws_access_key_id": settings.AWS_ACCESS_KEY_ID,
        "aws_secret_access_key": settings.AWS_SECRET_ACCESS_KEY,
        "region_name": settings.AWS_REGION,
    },
)

bucket_block = get_or_create_block(
    client,
    name="demo-s3-bucket",
    block_type_id=client.get("/block_types/slug/s3-bucket")
    .raise_for_status()
    .json()["id"],
    data={
        "bucket_name": settings.S3_BUCKET_NAME,
        "credentials": {"$ref": {"block_document_id": aws_creds["id"]}},
    },
)
```

<Accordion title="Run the complete example">

- set the aforementioned environment variables
- copy the python script below to your clipboard
- enter the following in your terminal to paste the script and run it

<CodeGroup>

```bash unix
pbpaste | uv run -
```

```bash windows
powershell -Command "Get-Clipboard | uv run -"
```

</CodeGroup>

```python create_s3_bucket_with_creds_in_workspace.py
# /// script
# dependencies = ["httpx", "pydantic-settings"]
# ///

from typing import Any
import httpx
from pydantic import Field
from pydantic_settings import BaseSettings, SettingsConfigDict


class PrefectSettings(BaseSettings):
    model_config = SettingsConfigDict(env_file=".env", extra="ignore")
    
    # if these are not set, we'll use localhost
    PREFECT_API_KEY: str | None = Field(default=None)
    PREFECT_ACCOUNT_ID: str | None = Field(default=None)
    PREFECT_WORKSPACE_ID: str | None = Field(default=None)
    
    AWS_ACCESS_KEY_ID: str = Field(default=...)
    AWS_SECRET_ACCESS_KEY: str = Field(default=...)
    AWS_REGION: str = Field(default="us-east-1")
    S3_BUCKET_NAME: str = Field(default=...)

    @property
    def api_url(self) -> str:
        if all([self.PREFECT_API_KEY, self.PREFECT_ACCOUNT_ID, self.PREFECT_WORKSPACE_ID]):
            return (
                f"https://api.prefect.cloud/api/accounts/{self.PREFECT_ACCOUNT_ID}"
                f"/workspaces/{self.PREFECT_WORKSPACE_ID}"
            )
        return "http://127.0.0.1:4200/api"

    @property
    def api_headers(self) -> dict[str, str]:
        if self.PREFECT_API_KEY:
            return {"Authorization": f"Bearer {self.PREFECT_API_KEY}"}
        return {}


def get_or_create_block(
    client: httpx.Client, name: str, block_type_id: str, data: dict[str, Any]
) -> dict[str, Any]:
    schema = sorted(
        client.post("/block_schemas/filter", json={"block_type_id": block_type_id})
        .raise_for_status()
        .json(),
        key=lambda x: x.get("created", ""),
    )[-1]

    if (
        response := (
            client.post(
                "/block_documents/",
                json={
                    "name": name,
                    "block_type_id": block_type_id,
                    "block_schema_id": schema["id"],
                    "data": data,
                },
            )
        )
    ).is_success:
        return response.json()

    if response.status_code == 409:
        blocks = (
            client.post(
                "/block_documents/filter",
                json={"block_documents": {"name": {"any_": [name]}}},
            )
            .raise_for_status()
            .json()
        )
        if not blocks:
            raise RuntimeError(f"Block {name} not found after 409 response")
        return blocks[0]

    response.raise_for_status()
    raise RuntimeError("Unexpected response")  # for type checker


if __name__ == "__main__":
    settings = PrefectSettings()
    print(f"üîë Connecting to {settings.api_url}")
    client = httpx.Client(
        base_url=settings.api_url,
        headers=settings.api_headers,
    )

    print("üèóÔ∏è  Creating AWS credentials block...")
    aws_creds = get_or_create_block(
        client,
        name="demo-aws-creds",
        block_type_id=client.get("/block_types/slug/aws-credentials")
        .raise_for_status()
        .json()["id"],
        data={
            "aws_access_key_id": settings.AWS_ACCESS_KEY_ID,
            "aws_secret_access_key": settings.AWS_SECRET_ACCESS_KEY,
            "region_name": settings.AWS_REGION,
        },
    )

    print("üì¶ Creating S3 bucket block...")
    bucket_block = get_or_create_block(
        client,
        name="demo-s3-bucket",
        block_type_id=client.get("/block_types/slug/s3-bucket")
        .raise_for_status()
        .json()["id"],
        data={
            "bucket_name": settings.S3_BUCKET_NAME,
            "credentials": {"$ref": {"block_document_id": aws_creds["id"]}},
        },
    )

    print("‚úÖ Verifying block structure...")
    client.get(f"/block_documents/{bucket_block['id']}").raise_for_status()
    print(f"üéâ All done! check out your block with `uvx prefect block inspect s3-bucket/{bucket_block['name']}`")
```

```bash output
¬ª pbpaste | uv run -

üîë Connecting to http://127.0.0.1:4200/api
üèóÔ∏è  Creating AWS credentials block...
üì¶ Creating S3 bucket block...
‚úÖ Verifying block structure...
üéâ All done! check out your block with `uvx prefect block inspect s3-bucket/demo-s3-bucket`
```

</Accordion>
