---
title: Run tasks in the background
description: See examples of using Prefect tasks and the task worker.
---

Prefect [tasks](/v3/develop/write-tasks)  help you quickly execute small, discrete units of work. Tasks have a `delay` method that allows you to defer execution to a task worker somewhere else (a long-lived process / container). Use background tasks to move work out of the foreground of your 
application and distribute concurrent execution across multiple processes or machines.

For example, imagine a web application that needs to trigger a task that will run longer than a desirable request-response cycle. You can defer tasks from your endpoint to independent, horizontally scalable task workers on separate infrastructure.

## Defining and running background tasks

- Define a task by adding the `@task` decorator to a Python function (like any other Prefect task)
- Use the `.delay()` method to background a run of this task
- Use the `.serve()` method or `serve()` function to start a task worker and execute any waiting task runs

```python
from prefect import task

@task
def add(a: int, b: int):
    return a + b

add.delay(1, 2) # background one task run
add.delay(42, 100) # background another task run


add.serve() # start a task worker and execute any waiting task runs
```

<Tip>
`.delay()` has the same signature as the `@task` decorated function.
</Tip>


To listen for multiple different background tasks at once, you can use the `serve()` function with a list of tasks:

```python
from prefect import task
from prefect.task_worker import serve

@task(log_prints=True)
def add(a: int, b: int):
    print(f"{a} + {b} = {a + b}")

@task(log_prints=True)
def multiply(a: int, b: int):
    print(f"{a} * {b} = {a * b}")

A = [1, 2, 3]
B = [4, 5, 6]

add.map(A, B, deferred=True) # background 3 task runs - i.e. zip(A, B)
multiply.map(A, B, deferred=True) # background 3 task runs - i.e. zip(A, B)

serve(add, multiply) # start a task worker listening for both `add` and `multiply`
```

<Tip>
`.map()` accepts `(list[P.args], list[P.kwargs])` for each task, and `deferred=True` to run the tasks in the background (instead of the current context's task runner)
</Tip>


<Accordion title="Beginner walkthrough of the Prefect background task examples repository">

Here are some examples of using deferred tasks and task workers in Prefect.

You will:

- run a Prefect task in the foreground by calling it
- start a task worker and defer tasks so that they run in the background
- create a basic FastAPI application that defers tasks when you hit an endpoint
- use Docker in two examples that mimic real use cases

One example uses a FastAPI server with multiple microservices and simulates a new user signup workflow.
The other example uses a Flask server with [Marvin](https://www.askmarvin.ai/) to ask questions of an LLM from the CLI 
and get back answers.

### Set up

<summary>Expand</summary>

#### Step 1: Activate a virtual environment

This example uses [conda](https://conda.io/projects/conda/en/latest/user-guide/install/index.html), 
but any virtual environment manager will work.

```bash
conda deactivate
conda create -n python-tasks python=3.12
conda activate python-tasks
```

#### Step 2: Install Python dependencies

```bash
pip install -U prefect marvin fastapi==0.107
```

#### Step 3: Connect to Prefect Cloud or a self-hosted Prefect server

Use either Prefect Cloud or a self-hosted Prefect server for these examples.

You must have `PREFECT_API_URL` set to send tasks to task workers.

If you're using a Prefect server with a SQLite backing database (the default database), 
save this value to your active Prefect Profile with the following command:

```bash
prefect config set PREFECT_API_URL=http://127.0.0.1:4200/api
```

If using Prefect Cloud, set the `PREFECT_API_URL` value to the Prefect Cloud API URL and add your 
[API key](https://docs.prefect.io/cloud/users/api-keys/).

The examples that use docker (examples 4 and 5) use a Prefect server by default.
You can switch to Prefect Cloud by changing the `PREFECT_API_URL` and adding a variable for your API key in the 
`docker-compose.yaml`.
Or use a Prefect server backed by a PostgreSQL database by setting the `PREFECT_API_DATABASE_CONNECTION_URL`.

If using Prefect server instead of Prefect Cloud, start your server by running the following command:

```bash
prefect server start 
```

#### Step 4: Clone the repository (optional)

Clone the repository to get the code files for the examples:

```bash
git clone https://github.com/PrefectHQ/prefect-background-task-examples.git
```

Move into the directory:

```bash
cd prefect-background-task-examples
```

### Example 1: Run a Prefect task in the foreground by calling it

<summary>Expand</summary>

Add the `@task` decorator to any Python function to define a Prefect task.

#### Step 1: Create a file with a task-decorated function 

Create a file and save the following code in it, or run the existing file in the 
basic-examples directory.

```python greeter.py
from prefect import task 

@task(log_prints=True)
def greet(name: str = "Marvin"):
    print(f"Hello, {name}!")

if __name__ == "__main__":
    greet()
```

#### Step 2: Run the script in the terminal

```bash
python greeter.py
```

You should see the task run in the terminal. This task runs in the foreground, meaning it is not deferred.

#### Optional

You can see the task run in the UI.
If you're using a self-hosted Prefect server instance, you can also see the task runs in the database.

If you want to inspect the SQLite database, use your favorite interface.
*DB Browser for SQLite* is explained below.

Download it [here](https://sqlitebrowser.org/dl/), if needed. Install it and open it.

Click *Connect*. Then navigate to your SQLite DB file. It's located in `~/.prefect` directory by default.

Go to the `task_run` table to see all your task runs there.
Scroll down to see your most recent task runs or filter for them.

Hit the refresh button for updates, if needed.

### Example 2: Start a task worker and run deferred tasks in the background

To run tasks in a separate process or container, start a task worker, similar to how you would run a 
Celery worker or an arq worker.
The task worker continually receives scheduled tasks to execute from Prefect's API, executes them, and reports the 
results back to the API.
Run a task worker by passing tasks into the `prefect.task_worker.serve()` method.

#### Step 1: Define the task and task worker in a file 

```python task_worker.py
from prefect import task
from prefect.task_worker import serve


@task
def my_background_task(name: str):
    print(f"Hello, {name}!")


if __name__ == "__main__":
    serve(my_background_task)
```

#### Step 2: Start the task worker by running the script in the terminal

```bash
python task_worker.py
```

The task worker is waiting for runs of the `my_background_task` task.

#### Step 3: Create a file and save the following code in it:

{/* pmd-metadata: notest */}
```python task_scheduler.py
from task_worker import my_background_task


if __name__ == "__main__":
    my_background_task.delay("Agrajag")
```

#### Step 4: Open another terminal and run the script

```bash
python task_scheduler.py
```

The code returns a "future" from the `delay` method. You can use this object to wait for the task to complete with 
`wait()` and to retrieve its result with `result()`.
You can also see the task run's UUID and other information about the task run.

#### Step 5: See the task run in the UI

Use the task run UUID to see the task run in the UI.
The URL will look like this:

`http://127.0.0.1:4200/task-runs/task-run/my_task_run_uuid_goes_here`

Substitute your UUID at the end of the URL.

#### Step 6: Use multiple task workers to run tasks in parallel

Start another instance of the task worker. In another terminal run:

```bash
python task_worker.py
```

#### Step 7: Send multiple tasks to the task worker

Modify the `task_scheduler.py` file to send multiple tasks to the task worker with different inputs:

{/* pmd-metadata: notest */}
```python
from task_worker import my_background_task

if __name__ == "__main__":
    my_background_task.delay("Ford")
    my_background_task.delay("Prefect")
    my_background_task.delay("Slartibartfast")
```

Run the file to see the work get distributed across both task workers.

#### Step 8: Shut down the task workers with *control* + *c*

This guide showed you how to send tasks to multiple Prefect task workers running in the background.
This allows you to observe these tasks executing in parallel and very quickly with web sockets, with no polling required.

See additional examples in the [deferred tasks GitHub repository](https://github.com/PrefectHQ/prefect-background-task-examples.git).
</Accordion>

## Next steps

- Explore a [complete example of a FastAPI application that backgrounds tasks](/v3/deploy/static-infrastructure-examples/background-tasks)