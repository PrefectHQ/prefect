---
title: fixtures
sidebarTitle: fixtures
---

# `prefect.testing.fixtures`

## Functions

### `add_prefect_loggers_to_caplog` <sup><a href="https://github.com/PrefectHQ/prefect/blob/main/src/prefect/testing/fixtures.py#L46" target="_blank">↗</a></sup>

```python
add_prefect_loggers_to_caplog(caplog: pytest.LogCaptureFixture) -> Generator[None, None, None]
```

### `is_port_in_use` <sup><a href="https://github.com/PrefectHQ/prefect/blob/main/src/prefect/testing/fixtures.py#L60" target="_blank">↗</a></sup>

```python
is_port_in_use(port: int) -> bool
```

### `use_hosted_api_server` <sup><a href="https://github.com/PrefectHQ/prefect/blob/main/src/prefect/testing/fixtures.py#L145" target="_blank">↗</a></sup>

```python
use_hosted_api_server(hosted_api_server: str) -> Generator[str, None, None]
```


Sets `PREFECT_API_URL` to the test session's hosted API endpoint.


### `disable_hosted_api_server` <sup><a href="https://github.com/PrefectHQ/prefect/blob/main/src/prefect/testing/fixtures.py#L159" target="_blank">↗</a></sup>

```python
disable_hosted_api_server() -> Generator[None, None, None]
```


Disables the hosted API server by setting `PREFECT_API_URL` to `None`.


### `enable_ephemeral_server` <sup><a href="https://github.com/PrefectHQ/prefect/blob/main/src/prefect/testing/fixtures.py#L172" target="_blank">↗</a></sup>

```python
enable_ephemeral_server(disable_hosted_api_server: None) -> Generator[None, None, None]
```


Enables the ephemeral server by setting `PREFECT_SERVER_ALLOW_EPHEMERAL_MODE` to `True`.


### `mock_anyio_sleep` <sup><a href="https://github.com/PrefectHQ/prefect/blob/main/src/prefect/testing/fixtures.py#L189" target="_blank">↗</a></sup>

```python
mock_anyio_sleep(monkeypatch: pytest.MonkeyPatch) -> Generator[Callable[[float], None], None, None]
```


Mock sleep used to not actually sleep but to set the current time to now + sleep
delay seconds while still yielding to other tasks in the event loop.

Provides "assert_sleeps_for" context manager which asserts a sleep time occurred
within the context while using the actual runtime of the context as a tolerance.


### `recorder` <sup><a href="https://github.com/PrefectHQ/prefect/blob/main/src/prefect/testing/fixtures.py#L292" target="_blank">↗</a></sup>

```python
recorder() -> Recorder
```

### `puppeteer` <sup><a href="https://github.com/PrefectHQ/prefect/blob/main/src/prefect/testing/fixtures.py#L297" target="_blank">↗</a></sup>

```python
puppeteer() -> Puppeteer
```

### `events_api_url` <sup><a href="https://github.com/PrefectHQ/prefect/blob/main/src/prefect/testing/fixtures.py#L375" target="_blank">↗</a></sup>

```python
events_api_url(events_server: Server, unused_tcp_port: int) -> str
```

### `events_cloud_api_url` <sup><a href="https://github.com/PrefectHQ/prefect/blob/main/src/prefect/testing/fixtures.py#L380" target="_blank">↗</a></sup>

```python
events_cloud_api_url(events_server: Server, unused_tcp_port: int) -> str
```

### `mock_should_emit_events` <sup><a href="https://github.com/PrefectHQ/prefect/blob/main/src/prefect/testing/fixtures.py#L385" target="_blank">↗</a></sup>

```python
mock_should_emit_events(monkeypatch: pytest.MonkeyPatch) -> mock.Mock
```

### `asserting_events_worker` <sup><a href="https://github.com/PrefectHQ/prefect/blob/main/src/prefect/testing/fixtures.py#L393" target="_blank">↗</a></sup>

```python
asserting_events_worker(monkeypatch: pytest.MonkeyPatch) -> Generator[EventsWorker, None, None]
```

### `asserting_and_emitting_events_worker` <sup><a href="https://github.com/PrefectHQ/prefect/blob/main/src/prefect/testing/fixtures.py#L406" target="_blank">↗</a></sup>

```python
asserting_and_emitting_events_worker(monkeypatch: pytest.MonkeyPatch) -> Generator[EventsWorker, None, None]
```

### `reset_worker_events` <sup><a href="https://github.com/PrefectHQ/prefect/blob/main/src/prefect/testing/fixtures.py#L472" target="_blank">↗</a></sup>

```python
reset_worker_events(asserting_events_worker: EventsWorker) -> Generator[None, None, None]
```

### `enable_lineage_events` <sup><a href="https://github.com/PrefectHQ/prefect/blob/main/src/prefect/testing/fixtures.py#L481" target="_blank">↗</a></sup>

```python
enable_lineage_events() -> Generator[None, None, None]
```


A fixture that ensures lineage events are enabled.


## Classes

### `Recorder` <sup><a href="https://github.com/PrefectHQ/prefect/blob/main/src/prefect/testing/fixtures.py#L262" target="_blank">↗</a></sup>

### `Puppeteer` <sup><a href="https://github.com/PrefectHQ/prefect/blob/main/src/prefect/testing/fixtures.py#L275" target="_blank">↗</a></sup>

### `AssertingEventsPipeline` <sup><a href="https://github.com/PrefectHQ/prefect/blob/main/src/prefect/testing/fixtures.py#L422" target="_blank">↗</a></sup>

### `AssertingAndEmittingEventsPipeline` <sup><a href="https://github.com/PrefectHQ/prefect/blob/main/src/prefect/testing/fixtures.py#L459" target="_blank">↗</a></sup>
