---
title: leasing
sidebarTitle: leasing
---

# `prefect.server.utilities.leasing`

## Functions

### `get_active_slots_from_leases` <sup><a href="https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/utilities/leasing.py#L84" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
get_active_slots_from_leases(limit_id: UUID, lease_storage: 'ConcurrencyLeaseStorage | None' = None) -> list[str]
```


Extract task_run IDs from active leases for a given limit.

Handles backends that provide a holder listing helper and those that do not by
falling back to scanning active leases.


### `find_lease_for_task_run` <sup><a href="https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/utilities/leasing.py#L157" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
find_lease_for_task_run(task_run_id: UUID, tags: list[str], db: PrefectDBInterface, lease_storage: 'ConcurrencyLeaseStorage | None' = None) -> UUID | None
```


Find the lease ID for a given task run across tag-based limits.

Attempts to use a backend helper if available; otherwise scans active leases.


## Classes

### `ResourceLease` <sup><a href="https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/utilities/leasing.py#L13" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

### `LeaseStorage` <sup><a href="https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/utilities/leasing.py#L21" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

**Methods:**

#### `create_lease` <sup><a href="https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/utilities/leasing.py#L22" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
create_lease(self, resource_ids: list[UUID], ttl: timedelta, metadata: T | None = None) -> ResourceLease[T]
```

Create a new resource lease.

**Args:**
- `resource_ids`: The IDs of the resources that the lease is associated with.
- `ttl`: How long the lease should initially be held for.
- `metadata`: Additional metadata associated with the lease.

**Returns:**
- A ResourceLease object representing the lease.


#### `read_lease` <sup><a href="https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/utilities/leasing.py#L38" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
read_lease(self, lease_id: UUID) -> ResourceLease[T] | None
```

Read a resource lease.

**Args:**
- `lease_id`: The ID of the lease to read.

**Returns:**
- A ResourceLease object representing the lease, or None if not found.


#### `renew_lease` <sup><a href="https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/utilities/leasing.py#L50" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
renew_lease(self, lease_id: UUID, ttl: timedelta) -> None
```

Renew a resource lease.

**Args:**
- `lease_id`: The ID of the lease to renew.
- `ttl`: The new amount of time the lease should be held for.


#### `revoke_lease` <sup><a href="https://github.com/PrefectHQ/prefect/blob/main/src/prefect/server/utilities/leasing.py#L60" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
revoke_lease(self, lease_id: UUID) -> None
```

Release a resource lease by removing it from list of active leases.

**Args:**
- `lease_id`: The ID of the lease to release.

