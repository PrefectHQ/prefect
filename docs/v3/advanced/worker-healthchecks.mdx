---
title: How to configure worker healthchecks
sidebarTitle: Worker Healthchecks
description: Learn how to monitor worker health and automatically restart workers when they become unresponsive.
---

Worker healthchecks provide a way to monitor whether your Prefect workers are functioning properly and polling for work as expected. This is particularly useful in production environments where you need to ensure workers are available to execute scheduled flow runs.

## Overview

Worker healthchecks work by:

1. **Tracking polling activity**: Workers record when they last polled for flow runs from their work pool
2. **Exposing a health endpoint**: When enabled, workers start an HTTP server that provides health status
3. **Detecting unresponsive workers**: The health endpoint returns an error status if the worker hasn't polled recently

This allows external monitoring systems, container orchestrators, or process managers to detect and restart unhealthy workers automatically.

## Enabling Healthchecks

Start a worker with healthchecks enabled using the `--with-healthcheck` flag:

```bash
prefect worker start --pool "my-pool" --with-healthcheck
```

This starts both the worker and a lightweight HTTP health server that exposes a `/health` endpoint.

## Health Endpoint

When healthchecks are enabled, the worker exposes an HTTP endpoint at:

```
http://localhost:8080/health
```

The endpoint returns:

- **200 OK** with `{"message": "OK"}` when the worker is healthy
- **503 Service Unavailable** with `{"message": "Worker may be unresponsive at this time"}` when the worker is unhealthy

### Configuring the Health Server

You can customize the health server's host and port using environment variables:

```bash
export PREFECT_WORKER_WEBSERVER_HOST=0.0.0.0
export PREFECT_WORKER_WEBSERVER_PORT=9090
prefect worker start --pool "my-pool" --with-healthcheck
```

## Health Detection Logic

A worker is considered unhealthy if it hasn't polled for flow runs within a specific timeframe. The algorithm works as follows:

1. **Polling threshold**: The threshold is calculated as `query_interval_seconds * 30`
2. **Default query interval**: Workers poll every 15 seconds by default (configurable via `PREFECT_WORKER_QUERY_SECONDS`)
3. **Default threshold**: With the default settings, a worker is unhealthy if it hasn't polled in 450 seconds (7.5 minutes)

This generous threshold accounts for temporary network issues, API unavailability, or brief worker pauses.

## Production Deployment Patterns

### Docker with Health Checks

Use Docker's built-in health check functionality:

```dockerfile
FROM prefecthq/prefect:3-python3.11

# Install your flow dependencies
COPY requirements.txt .
RUN pip install -r requirements.txt

# Copy your flows
COPY flows/ /flows/

# Health check configuration
HEALTHCHECK --interval=30s --timeout=10s --start-period=60s --retries=3 \
  CMD curl -f http://localhost:8080/health || exit 1

# Start worker with healthcheck
CMD ["prefect", "worker", "start", "--pool", "my-pool", "--with-healthcheck"]
```

### Kubernetes with Liveness Probes

Configure Kubernetes to automatically restart unhealthy worker pods:

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: prefect-worker
spec:
  replicas: 2
  selector:
    matchLabels:
      app: prefect-worker
  template:
    metadata:
      labels:
        app: prefect-worker
    spec:
      containers:
      - name: worker
        image: my-prefect-worker:latest
        command: ["prefect", "worker", "start", "--pool", "my-pool", "--with-healthcheck"]
        env:
        - name: PREFECT_API_URL
          value: "https://api.prefect.cloud/api/accounts/[ACCOUNT_ID]/workspaces/[WORKSPACE_ID]"
        - name: PREFECT_API_KEY
          valueFrom:
            secretKeyRef:
              name: prefect-api-key
              key: key
        ports:
        - containerPort: 8080
          name: health
        livenessProbe:
          httpGet:
            path: /health
            port: 8080
          initialDelaySeconds: 60
          periodSeconds: 30
          timeoutSeconds: 10
          failureThreshold: 3
        readinessProbe:
          httpGet:
            path: /health
            port: 8080
          initialDelaySeconds: 30
          periodSeconds: 10
```

### Systemd with Restart Policy

For systemd-managed workers, create a service file with automatic restart:

```ini
[Unit]
Description=Prefect Worker
After=network.target

[Service]
Type=exec
User=prefect
WorkingDirectory=/opt/prefect
Environment=PREFECT_API_URL=https://api.prefect.cloud/api/accounts/[ACCOUNT_ID]/workspaces/[WORKSPACE_ID]
Environment=PREFECT_API_KEY=your-api-key
ExecStart=/opt/prefect/venv/bin/prefect worker start --pool "my-pool" --with-healthcheck
ExecStartPost=/bin/sleep 30
ExecReload=/bin/kill -HUP $MAINPID
Restart=always
RestartSec=30

# Health check using systemd-watchdog
WatchdogSec=600
Type=notify

[Install]
WantedBy=multi-user.target
```

Add a health check script that systemd can use:

```bash
#!/bin/bash
# /opt/prefect/health-check.sh
curl -f http://localhost:8080/health || exit 1
```

### Docker Compose with Health Checks

```yaml
version: '3.8'
services:
  prefect-worker:
    image: my-prefect-worker:latest
    command: ["prefect", "worker", "start", "--pool", "my-pool", "--with-healthcheck"]
    environment:
      - PREFECT_API_URL=https://api.prefect.cloud/api/accounts/[ACCOUNT_ID]/workspaces/[WORKSPACE_ID]
      - PREFECT_API_KEY=your-api-key
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s
    restart: unless-stopped
```

## Troubleshooting

### Common Issues

**Health endpoint not accessible:**
- Verify the worker was started with `--with-healthcheck`
- Check that the configured host/port is accessible
- Ensure no firewall rules are blocking the health port

**False positive health failures:**
- Increase `PREFECT_WORKER_QUERY_SECONDS` if your API has high latency
- Check for network connectivity issues between worker and Prefect API
- Review worker logs for authentication or authorization errors

**Worker appears healthy but not processing flows:**
- Health checks only verify polling activity, not successful flow execution
- Check work pool configuration and flow run states
- Verify worker has access to required infrastructure (Docker, Kubernetes, etc.)

## Related Configuration

Relevant settings for worker health and polling behavior:

- `PREFECT_WORKER_HEARTBEAT_SECONDS`: How often workers send heartbeats to the API (default: 30)
- `PREFECT_WORKER_QUERY_SECONDS`: How often workers poll for new flow runs (default: 15)  
- `PREFECT_WORKER_PREFETCH_SECONDS`: How far in advance to submit flow runs (default: 10)
- `PREFECT_WORKER_WEBSERVER_HOST`: Health server host (default: 127.0.0.1)
- `PREFECT_WORKER_WEBSERVER_PORT`: Health server port (default: 8080)

## Further Reading

For more information on worker configuration, see the [Workers concept guide](/v3/concepts/workers/).