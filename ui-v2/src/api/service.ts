import createClient, { type Middleware } from "openapi-fetch";
import type { paths } from "./prefect.ts"; // generated by openapi-typescript

const throwOnError: Middleware = {
	async onResponse({ response }) {
		if (!response.ok) {
			const body = (await response.clone().json()) as Record<string, unknown>;
			throw new Error(body.detail as string | undefined);
		}
	},
};
// TODO: Make the baseUrl configurable
export const createQueryService = () => {
	const client = createClient<paths>({
		baseUrl: "http://localhost:4200/api",
	});
	client.use(throwOnError);
	return client;
};
